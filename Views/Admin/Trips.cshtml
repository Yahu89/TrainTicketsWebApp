@using TrainTicketsWebApp.CQRS.Queries.Trip
@using TrainTicketsWebApp.Models.Dto
@* @model List<TripDto> *@
@model TripsPaginationResultView

<h2>Lista przejazdów: </h2>
<br />

<table class="table table-bordered table-striped" style="width: 100%">
    <thead>
        <tr>
            <th>
                Id
            </th>
            <th>
                Nazwa trasy
            </th>
            <th>
                Data odjazdu
            </th>
            <th>
                Godzina odjazdu
            </th>
            <th>
                Typ pociągu
            </th>
            <th>

            </th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model.Trips)
        {
            <tr>
                <td>
                    @item.Id
                </td>
                <td>
                    @item.RouteName
                </td>
                <td>
                    @item.DepartureDate.ToString("yyyy-MM-dd")
                </td>
                <td>
                    @item.DepartureTime.ToString("HH:mm")
                </td>
                <td>
                    @item.TrainType
                </td>
                <td>
                    <button class="btn btn-danger" data-toggle="modal" data-target="#warning" id="trip" name="@item.Id" onclick="takeId(this)">Usuń</button>
                </td>
            </tr>
        }

    </tbody>
</table>


<div class="modal fade" id="warning" tabindex="-1" aria-labelledby="warningLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="warningLabel">Ostrzeżenie</h1>
                <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h6 id="warnContent">Czy na pewno chcesz usunąć przejazd?</h6>
            </div>
            <div class="modal-footer" id="result">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Nie</button>
                <button id="submitButton" type="submit" class="btn btn-danger" onclick="onSubmit(this)">Tak</button>
            </div>
        </div>
    </div>
</div>


<nav aria-label="...">
    <ul class="pagination">
        @if (Model.CurrentPageNumber > 1)
        {
            <li class="page-item">
                <a class="page-link" href="/Admin/Trips?currentPageNumber=@(Model.CurrentPageNumber-1)">Poprzednia</a>
            </li>
        }
        else
        {
            <li class="page-item disabled">
                <a class="page-link" href="#">Poprzednia</a>
            </li>
        }

        @for (int i = 1; i <= Model.TotalPages; i++)
        {
            if (Model.CurrentPageNumber == i)
            {
                <li class="page-item active">
                    <a class="page-link" href="/Admin/Trips?currentPageNumber=@i"> <span class="sr-only">@i</span></a>
                </li>
            }
            else
            {
                <li class="page-item">
                    <a class="page-link" href="/Admin/Trips?currentPageNumber=@i"> <span class="sr-only">@i</span></a>
                </li>
            }
        }

        @if (Model.CurrentPageNumber < Model.TotalPages)
        {
            <li class="page-item">
                <a class="page-link" href="/Admin/Trips?currentPageNumber=@(Model.CurrentPageNumber+1)">Następna</a>
            </li>
        }
        else
        {
            <li class="page-item disabled">
                <a class="page-link" href="#">Następna</a>
            </li>
        }

    </ul>
</nav>

<div class="container">
    <div class="row">
        <a class="btn btn-secondary" asp-controller="Admin" asp-action="Index">Wróć do menu</a>
    </div>
</div>


@section Scripts 
{
    <script>
        $(document).ready(function () {
            // $('#submitButton').click(() => {
            //     onSubmit(this);
            // });
        });

        var tripId = {};

        function takeId(c) {
            tripId = $(c).attr('name');
            return tripId;
        }

        function onSubmit(e) {
            // tripId = takeId(c);
            submitUrl = '/Admin/DeleteTrip';
            console.log(tripId);
            $.ajax({
                url: submitUrl,
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(tripId),
                success: function (response) {
                    window.location.href = response.redirectToUrl;
                },
                error: function (error) {
                    window.location.href = response.redirectToUrl;
                }
            });
        }
    </script>
}