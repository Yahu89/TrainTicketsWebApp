@using TrainTicketsWebApp.CQRS.Commands.Route
@using TrainTicketsWebApp.CQRS.Commands.TrainType
@using TrainTicketsWebApp.CQRS.Queries.Tour
@using TrainTicketsWebApp.Models.Dto
@* @model RouteDetailsCreationView *@
@model SearchTourModelView

@{
	var getDay = DateTime.Now; 
	var currentDay = DateTime.Now.ToString("yyyy-MM-dd");
	var currentTime = new TimeSpan(0, 0, 0); 
}

<h2>Wyszukiwarka połączeń:</h2>
<br />

<form method="post" class="row" asp-controller="Schedule" asp-action="SearchTour">
	<table class="table table-bordered table-striped" style="width: 100%">
		<thead>
			<tr>
				<th>
					Skąd:
				</th>
				<th>
					Dokąd:
				</th>
				<th>
					Data odjazdu:
				</th>
				<th>
					Godzina odjazdu:
				</th>
				<th>
					Dopuść przesiadki:
				</th>
			</tr>
		</thead>

		<tbody>

			<tr>
				<td>
					@Html.DropDownList("SearchTourData.From", Model.From, new { @class = "form-select border-0 shadow mb-2" })
				</td>
				<td>
					@Html.DropDownList("SearchTourData.To", Model.To, new { @class = "form-select border-0 shadow mb-2" })
				</td>
				<td>
					<input class="form-control border-0 shadow mb-2" type="date" value="@currentDay" name="SearchTourData.DepartureDay" />
					<span class="text-danger" ></span>
				</td>
				<td>
					<input class="form-control border-0 shadow mb-2" type="time" value="@currentTime" name="SearchTourData.DepartureTime" />
					<span class="text-danger"></span>
				</td>
				<td>
					<input class="w-100 h-100" type="checkbox" />
					<span class="text-danger"></span>
				</td>
			</tr>

		</tbody>
	</table>

	<div class="container">
		<div class="row">
			<div class="col-3">
				<button type="submit" class="btn btn-info form-control mb-2">Szukaj połączenia</button>
			</div>
			<div class="col-3">
				<a class="btn btn-secondary" asp-controller="Admin" asp-action="Index">Wróć do menu</a>
			</div>
		</div>
	</div>
</form>
<br />

@if(Model.SearchResultList.Count > 0)
{
	<h5>Znalezione połączenia:</h5>
	<table class="table table-bordered table-striped" style="width: 100%">
		<thead>
			<tr>
				<th>
					Skąd
				</th>
				<th>
					Dokąd
				</th>
				<th>
					Data odjazdu
				</th>
				<th>
					Data przyjazdu
				</th>
				<th>
					Dostępność miejsc
				</th>
				<th>

				</th>
			</tr>
		</thead>

		<tbody>
			@foreach (var item in Model.SearchResultList)
			{
				<tr>
					<td>
						@item.From
					</td>
					<td>
						@item.To
					</td>
					<td>
						@item.DepartureTime
					</td>
					<td>
						@item.ArrivalTime
					</td>
					<td>
						@item.TrainType
					</td>
					<td>
						@item.PlacesAvailable
					</td>
					<td>
						@if (item.PlacesAvailable > 0)
						{
							<form method="post" asp-controller="Tour" asp-action="Reservation">
								<input hidden name="TripId" value="@item.TripId" />
								<input hidden name="From" value="@item.From" />
								<input hidden name="To" value="@item.To" />
								<input hidden name="DepartureTime" value="@item.DepartureTime" />
								<input hidden name="ArrivalTime" value="@item.ArrivalTime" />
								<input hidden name="TrainType" value="@item.TrainType" />
								<input hidden name="To" value="@item.To" />
								<input hidden name="SegmentNumberFrom" value="@item.SegmentNumberFrom" />
								<input hidden name="SegmentNumberTo" value="@item.SegmentNumberTo" />

								<button class="btn btn-info" type="submit">Kup bilet</button>

							</form>
						}
						else
						{
							<buton class="btn btn-secondary" disabled>Kup bilet</buton>
						}

					</td>
				</tr>
			}
		</tbody>
	</table>
}


